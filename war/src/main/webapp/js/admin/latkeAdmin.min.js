/*
 * Copyright (c) 2009, 2010, 2011, 2012, B3log Team
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 *  index for admin
 *
 * @author <a href="mailto:LLY219@gmail.com">Liyuan Li</a>
 * @version 1.0.1.9, Jun 19, 2012
 */var Admin=function(){this.register={},this.tools=["#page-list","#file-list","#link-list","#preference","#user-list","#plugin-list","#others"],this.adTools=["link-list","preference","file-list","page-list","user-list","plugin-list"]};$.extend(Admin.prototype,{logout:function(){window.location.href=latkeConfig.servePath+"/logout?goto="+latkeConfig.servePath},setHashByPage:function(e){var t=window.location.hash,n=t.split("/");/^\d*$/.test(n[n.length-1])?n[n.length-1]=e:n.push(e),window.location.hash=n.join("/")},selectTab:function(e){window.location.hash="#"+e},analyseHash:function(){var e=window.location.hash,t=e.substr(1,e.length-1),n=t.split("/"),r={};r.page=1,r.hashList=[];for(var i=0;i<n.length;i++)i===n.length-1&&/^\d+$/.test(n[i])?r.page=n[i]:r.hashList.push(n[i]);return r},setCurByHash:function(){var e=admin.analyseHash(),t=e.hashList[1],n=e.hashList[2];e.hashList.length===1&&(t=e.hashList[0]);if(t==="")return;try{if(t!=="article"&&admin.article.isConfirm&&admin.editorArticle.getContent().replace(/\s/g,"")!==""&&!confirm(Label.editorLeaveLabel)){window.location.hash="#article/article";return}if(t==="article"&&admin.article.isConfirm&&admin.editorArticle.getContent().replace(/\s/g,"")!=="")return}catch(r){var i=$("#articleContent");if(i.length>0){if(t!=="article"&&admin.article.isConfirm&&i.val().replace(/\s/g,"")!==""&&!confirm(Label.editorLeaveLabel)){window.location.hash="#article/article";return}if(t==="article"&&admin.article.isConfirm&&i.val().replace(/\s/g,"")!=="")return}}t!=="article"&&admin.editorArticle.setContent&&admin.article.clear(),admin.article.isConfirm=!0,$("#tabs").tabs("setCurrent",t),$("#loadMsg").text(Label.loadingLabel),$("#tabsPanel_"+t).length===1?$("#tabsPanel_"+t).html().replace(/\s/g,"")===""?$("#tabsPanel_"+t).load("admin-"+t+".do",function(){t==="article"&&admin.article.status.id?admin.register[t].init.call(admin.register[t].obj,admin.article.getAndSet):admin.register[t].init.call(admin.register[t].obj,e.page),n&&$("#tab"+t.substring(0,1).toUpperCase()+t.substring(1)).tabs("setCurrent",n),admin.plugin.setCurByHash(e)}):(t==="article"&&admin.article.status.id&&admin.article.getAndSet(),admin.register[t]&&admin.register[t].refresh&&admin.register[t].refresh.call(admin.register[t].obj,e.page),n&&$("#tab"+t.substring(0,1).toUpperCase()+t.substring(1)).tabs("setCurrent",n),admin.plugin.setCurByHash(e)):($("#tipMsg").text("Error: No tab! "+Label.reportIssueLabel),$("#loadMsg").text(""))},init:function(){Util.killIE(),$("#loadMsg").text(Label.loadingLabel),$("#tabs").tabs(),setInterval(function(){$("#tipMsg").text()!==""&&setTimeout(function(){$("#tipMsg").text("")},7e3)},6e3),$("#loadMsg").text("")},collapseNav:function(e){var t=$(e).next();t.slideToggle("normal",function(){this.style.display!=="none"?$(e).find(".ico-arrow-down")[0].className="ico-arrow-up":$(e).find(".ico-arrow-up")[0].className="ico-arrow-down"})},inited:function(){if(Label.userRole!=="adminRole"){for(var e=0;e<this.adTools.length;e++)$("#tabs").tabs("remove",this.adTools[e]);$("#tabs>ul>li").last().remove()}else for(var t=0;t<this.tools.length;t++)if("#"+window.location.hash.split("/")[1]===this.tools[t]){$("#tabToolsTitle").click();break}this.setCurByHash()}});var admin=new Admin;admin.editors={};var Editor=function(e){this._defaults={type:"tinyMCE",kind:"",id:"",language:""},e.type=Label.editorType,this.conf=e,this._init()};$.extend(Editor.prototype,{_init:function(){this.init()},init:function(){var e=this.conf,t=e.type.split("-");t.length===2&&(e.codeMirrorLanguage=t[1],e.type=t[0]),admin.editors[e.type].init(e)},getContent:function(){var e=this.conf;return admin.editors[e.type].getContent(e.id)},setContent:function(e){var t=this.conf;admin.editors[t.type].setContent(t.id,e)}}),admin.editorArticle={},admin.editorAbstract={},admin.editorPage={},admin.editors.tinyMCE={init:function(e){var t=Label.localeString.substring(0,2);t==="zh"&&(t="zh-cn");if(e.kind&&e.kind==="simple")try{tinyMCE.init({language:t,mode:"exact",elements:e.id,theme:"advanced",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,undo,redo,|,bullist,numlist",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",valid_children:"+body[style]"})}catch(n){$("#tipMsg").text("TinyMCE load fail")}else try{tinyMCE.init({language:t,mode:"exact",elements:e.id,theme:"advanced",plugins:"autosave,style,advhr,advimage,advlink,preview,inlinepopups,media,paste,syntaxhl,wordcount",theme_advanced_buttons1:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,strikethrough,forecolor,|,advhr,blockquote,syntaxhl,",theme_advanced_buttons2:"undo,redo,|,bullist,numlist,outdent,indent,|,justifyleft,justifycenter,justifyright,justifyfull,|,pastetext,pasteword,|,link,unlink,image,iespell,media,|,cleanup,code,preview,",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_resizing:!0,theme_advanced_statusbar_location:"bottom",extended_valid_elements:"link[type|rel|href|charset],pre[name|class],iframe[src|width|height|name|align],+a[*]",valid_children:"+body[style]",relative_urls:!1,remove_script_host:!1,oninit:function(){typeof e.fun=="function"&&e.fun()}})}catch(n){$("#tipMsg").text("TinyMCE load fail")}},getContent:function(e){var t="";try{t=tinyMCE.get(e).getContent()}catch(n){t=$("#"+e).val()}return t},setContent:function(e,t){try{tinyMCE.get(e)?tinyMCE.get(e).setContent(t):$("#"+e).val(t)}catch(n){$("#"+e).val(t)}}},admin.editors.KindEditor={init:function(e){var t="zh_CN";"en_US"===Label.localeString&&(t="en");if(e.kind&&e.kind==="simple")try{this[e.id]=KindEditor.create("#"+e.id,{langType:t,resizeType:0,items:["bold","italic","underline","strikethrough","|","undo","redo","|","insertunorderedlist","insertorderedlist"]})}catch(n){$("#tipMsg").text("KindEditor load fail")}else try{this[e.id]=KindEditor.create("#"+e.id,{langType:t,items:["formatblock","fontname","fontsize","|","bold","italic","underline","strikethrough","forecolor","|","link","unlink","image","media","|","pagebreak","emoticons","code","/","undo","redo","|","insertunorderedlist","insertorderedlist","indent","outdent","|","justifyleft","justifycenter","justifyright","justifyfull","|","plainpaste","wordpaste","|","clearhtml","source","preview"],afterCreate:function(){typeof e.fun=="function"&&e.fun()}})}catch(n){$("#tipMsg").text("KindEditor load fail")}},getContent:function(e){var t="";try{t=this[e].html()}catch(n){t=$("#"+e).val()}return t},setContent:function(e,t){try{this[e].html(t)}catch(n){$("#"+e).val(t)}}},admin.editors.CodeMirror={init:function(e){var t=this,n="<div class='clear'></div>";e.kind!=="simple"&&(n="<div class='markdown-preivew'><div class='markdown-help ico-close'></div><div class='clear'></div><div class='markdown-preview-main none'></div><div class='markdown-help-main'>"+Label.markdownHelpLabel+"</div>","</div><div class='clear'></div>"),$("#"+e.id).after(n);if(e.kind==="simple")this[e.id]=CodeMirror.fromTextArea(document.getElementById(e.id),{mode:"markdown",lineNumbers:!0,matchBrackets:!0,theme:"default",height:e.height});else{t[e.id+"Timers"]=[],t[e.id+"IsFirst"]=!0;var r=$("#"+e.id).parent().find(".markdown-preivew"),i=$("#"+e.id).parent().find(".markdown-preivew").find(".markdown-help");this[e.id]=CodeMirror.fromTextArea(document.getElementById(e.id),{mode:"markdown",lineNumbers:!0,matchBrackets:!0,theme:"default",height:e.height,onUpdate:function(){var n=function(){if(t[e.id].getValue()==="")return;$.ajax({url:latkeConfig.servePath+"/console/markdown/2html",type:"POST",cache:!1,data:"markdownText="+t[e.id].getValue(),success:function(n,s){n.sc?(t[e.id+"IsFirst"]&&i.hasClass("ico-close")&&i.click(),t[e.id+"IsFirst"]=!1,r.find(".markdown-preview-main").html(n.html)):r.find(".markdown-preview-main").html(n.msg)}})};t[e.id+"Timers"].push(n)}}),this._callPreview(e.id,t[e.id+"Timers"])}e.kind==="simple"?$("#"+e.id).next().width("99%"):this._bindEvent(e.id),typeof e.fun=="function"&&e.fun()},_callPreview:function(e){setInterval(function(){var t=admin.editors.CodeMirror[e+"Timers"];$(document).queue("myAnimation",[t[t.length-1]]),$(document).dequeue("myAnimation"),admin.editors.CodeMirror[e+"Timers"]=[]},2e3)},_bindEvent:function(e){var t=$("#"+e).parent().find(".markdown-preivew");t.find(".markdown-help").click(function(){var e=$(this);e.hasClass("ico-help")?(e.removeClass("ico-help").addClass("ico-close"),t.find(".markdown-preview-main").hide(),t.find(".markdown-help-main").show()):(e.addClass("ico-help").removeClass("ico-close"),t.find(".markdown-preview-main").show(),t.find(".markdown-help-main").hide())})},getContent:function(e){return this[e].getValue()},setContent:function(e,t){this[e].setValue(t)}};var TablePaginate=function(e){this.id=e,this.currentPage=1};$.extend(TablePaginate.prototype,{buildTable:function(e,t){var n={colModel:e,noDataTip:Label.noDataLabel};t||(n.expendRow={index:"expendRow"}),$("#"+this.id+"Table").table(n)},initPagination:function(){var e=this.id;$("#"+e+"Pagination").paginate({bind:function(e,t){t?$("#tipMsg").text(t):admin.setHashByPage(e)},currentPage:1,errorMessage:Label.inputErrorLabel,nextPageText:Label.nextPagePabel,previousPageText:Label.previousPageLabel,goText:Label.gotoLabel,type:"custom",custom:[1],pageCount:1})},initCommentsDialog:function(){var e=this;$("#"+this.id+"Comments").dialog({modal:!0,hideFooter:!0,close:function(){return admin[e.id+"List"].getList(e.currentPage),!0}})},updateTablePagination:function(e,t,n){t=parseInt(t);if(t>n.paginationPageCount&&t>1){$("#tipMsg").text(Label.pageLabel+t+Label.notFoundLabel),$("#loadMsg").text("");return}$("#"+this.id+"Table").table("update",{data:[{groupName:"all",groupData:e}]}),n.paginationPageCount===0&&(n.paginationPageCount=1),$("#"+this.id+"Pagination").paginate("update",{pageCount:n.paginationPageCount,currentPage:t,custom:n.paginationPageNums}),this.currentPage=t}}),admin.article={isConfirm:!0,status:{id:undefined,isArticle:undefined,articleHadBeenPublished:undefined},get:function(e,t){this.status.id=e,this.status.isArticle=t,admin.selectTab("article/article")},getAndSet:function(){$("#loadMsg").text(Label.loadingLabel),$.ajax({url:latkeConfig.servePath+"/console/article/"+admin.article.status.id,type:"GET",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}$("#title").val(e.article.articleTitle),admin.article.status.articleHadBeenPublished=e.article.articleHadBeenPublished,admin.editorArticle.setContent(e.article.articleContent),admin.editorAbstract.setContent(e.article.articleAbstract);var n=e.article.articleTags,r="";for(var i=0;i<n.length;i++)0===i?r=n[i].tagTitle:r+=","+n[i].tagTitle;$("#tag").val(r),$("#permalink").val(e.article.articlePermalink),$("#viewPwd").val(e.article.articleViewPwd),$("#articleCommentable").prop("checked",e.article.articleCommentable);var s=e.article.signs;$(".signs button").each(function(t){parseInt(e.article.articleSignId)===parseInt(s[t].oId)?$("#articleSign"+s[t].oId).addClass("selected"):$("#articleSign"+s[t].oId).removeClass("selected")}),admin.article.setStatus(),$("#loadMsg").text("")}})},del:function(e,t){var n=confirm(Label.confirmRemoveLabel);n&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:latkeConfig.servePath+"/console/article/"+e,type:"DELETE",cache:!1,success:function(e,n){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin[t+"List"].getList(1)}}))},add:function(e){if(admin.article.validate()){var t=this;t._addDisabled(),$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var n="";$(".signs button").each(function(){this.className==="selected"&&(n=this.id.substr(this.id.length-1,1))});var r=admin.editorArticle.getContent(),i=admin.editorAbstract.getContent(),s={article:{articleTitle:$("#title").val(),articleContent:r,articleAbstract:i,articleTags:this.trimUniqueArray($("#tag").val()).toString(),articlePermalink:$("#permalink").val(),articleIsPublished:e,articleSignId:n,postToCommunity:$("#postToCommunity").prop("checked"),articleCommentable:$("#articleCommentable").prop("checked"),articleViewPwd:$("#viewPwd").val()}};$.ajax({url:latkeConfig.servePath+"/console/article/",type:"POST",cache:!1,data:JSON.stringify(s),success:function(t,n){$("#tipMsg").text(t.msg);if(!t.sc){$("#loadMsg").text("");return}e?(admin.article.status.id=undefined,admin.selectTab("article/article-list")):admin.selectTab("article/draft-list"),admin.article.isConfirm=!1,$("#loadMsg").text("")},complete:function(n,r){t._removeDisabled(),n.status===403&&($.get("/admin-index.do"),t.add(e))}})}},update:function(e){if(admin.article.validate()){var t=this;t._addDisabled(),$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var n="";$(".signs button").each(function(){this.className==="selected"&&(n=this.id.substr(this.id.length-1,1))});var r=admin.editorArticle.getContent(),i=admin.editorAbstract.getContent(),s={article:{oId:this.status.id,articleTitle:$("#title").val(),articleContent:r,articleAbstract:i,articleTags:this.trimUniqueArray($("#tag").val()).toString(),articlePermalink:$("#permalink").val(),articleIsPublished:e,articleSignId:n,articleCommentable:$("#articleCommentable").prop("checked"),articleViewPwd:$("#viewPwd").val()}};$.ajax({url:latkeConfig.servePath+"/console/article/",type:"PUT",cache:!1,data:JSON.stringify(s),success:function(t,n){$("#tipMsg").text(t.msg);if(!t.sc){$("#loadMsg").text("");return}e?admin.selectTab("article/article-list"):admin.selectTab("article/draft-list"),$("#tipMsg").text(Label.updateSuccLabel),admin.article.status.id=undefined,admin.article.isConfirm=!1,$("#loadMsg").text("")},complete:function(n,r){t._removeDisabled(),n.status===403&&($.get("/admin-index.do"),t.update(e))}})}},setStatus:function(){this.status?(this.status.isArticle?($("#unSubmitArticle").show(),$("#submitArticle").hide()):($("#submitArticle").show(),$("#unSubmitArticle").hide()),this.status.articleHadBeenPublished?$("#postToCommunityPanel").hide():$("#postToCommunityPanel").show()):($("#submitArticle").show(),$("#unSubmitArticle").hide(),$("#postToCommunityPanel").show()),$("#postToCommunity").attr("checked","checked")},clear:function(){this.status={id:undefined,isArticle:undefined,articleHadBeenPublished:undefined},this.setStatus(),$("#title").val(""),admin.editorArticle.setContent(""),admin.editorAbstract.setContent(""),$("#tag").val(""),$("#tagCheckboxPanel").hide().find("span").removeClass("selected"),$("#permalink").val(""),$("#articleCammentable").prop("checked",!0),$("#postToCommunity").prop("checked",!0),$(".signs button").each(function(e){e===0?this.className="selected":this.className=""})},init:function(e){$.ajax({url:latkeConfig.servePath+"/console/signs/",type:"GET",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}$(".signs button").each(function(t){t===e.signs.length?$("#articleSign1").addClass("selected"):$("#articleSign"+e.signs[t].oId).tip({content:e.signs[t].signHTML===""?Label.signIsNullLabel:e.signs[t].signHTML.replace(/\n/g,"").replace(/<script.*<\/script>/ig,""),position:"top"}),$(this).click(function(){this.className!=="selected"&&($(".signs button").each(function(){this.className=""}),this.className="selected")})}),$("#loadMsg").text("")}}),$.ajax({url:latkeConfig.servePath+"/console/tags",type:"GET",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}if(0>=e.tags.length)return;var n=[];for(var r=0;r<e.tags.length;r++)n.push(e.tags[r].tagTitle);$("#tag").completed({height:160,buttonText:Label.selectLabel,data:n}),$("#loadMsg").text("")}}),$("#submitArticle").click(function(){admin.article.status.id?admin.article.update(!0):admin.article.add(!0)}),$("#saveArticle").click(function(){admin.article.status.id?admin.article.update(admin.article.status.isArticle):admin.article.add(!1)}),admin.editorArticle=new Editor({id:"articleContent",kind:"all",fun:e,height:500}),admin.editorAbstract=new Editor({id:"abstract",kind:"simple",height:200})},validate:function(){var e=admin.editorArticle.getContent();if($("#title").val().replace(/\s/g,"")==="")$("#tipMsg").text(Label.titleEmptyLabel),$("#title").focus().val("");else if(e.replace(/\s/g,"")==="")$("#tipMsg").text(Label.contentEmptyLabel);else{if($("#tag").val().replace(/\s/g,"")!=="")return!0;$("#tipMsg").text(Label.tagsEmptyLabel),$("#tag").focus().val("")}return!1},unPublish:function(){var e=this;e._addDisabled(),$.ajax({url:latkeConfig.servePath+"/console/article/unpublish/"+admin.article.status.id,type:"PUT",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.selectTab("article/draft-list"),admin.article.status.id=undefined,admin.article.isConfirm=!1},complete:function(t,n){e._removeDisabled(),t.status===403&&($.get("/admin-index.do"),e.unPublish())}})},trimUniqueArray:function(e){e=e.toString();var t=e.split(",");for(var n=0;n<t.length;n++)t[n]=t[n].replace(/(^\s*)|(\s*$)/g,""),t[n]===""&&(t.splice(n,1),n--);var r=$.unique(t);return r.toString()},prePost:function(){$("#loadMsg").text(Label.loadingLabel);if(!admin.editorArticle.getContent)return;var e=admin.editorArticle.getContent();window.location.hash==="#article/article"&&e.replace(/\s/g,"")!==""&&confirm(Label.editorPostLabel)&&admin.article.clear(),$("#loadMsg").text("")},_addDisabled:function(){$("#unSubmitArticle").attr("disabled","disabled"),$("#saveArticle").attr("disabled","disabled"),$("#submitArticle").attr("disabled","disabled")},_removeDisabled:function(){$("#unSubmitArticle").removeAttr("disabled"),$("#saveArticle").removeAttr("disabled"),$("#submitArticle").removeAttr("disabled")}},admin.register.article={obj:admin.article,init:admin.article.init,refresh:function(){$("#loadMsg").text("")}},admin.comment={open:function(e,t){this.getList(e,t),$("#"+t+"Comments").dialog("open")},getList:function(e,t){$("#loadMsg").text(Label.loadingLabel),$("#"+t+"Comments").html("");var n="article";t==="page"&&(n="page"),$.ajax({url:latkeConfig.servePath+"/console/comments/"+n+"/"+e,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=n.comments,s="";for(var o=0;o<i.length;o++){var u="<a target='_blank' href='"+i[o].commentURL+"'>",a=i[o].commentContent,f=Util.replaceEmString(a);i[o].commentURL==="http://"&&(u="<a target='_blank'>"),s+="<div class='comment-title'><span class='left'>"+u+i[o].commentName+"</a>",i[o].commentOriginalCommentName&&(s+="@"+i[o].commentOriginalCommentName),s+="</span><span title='"+Label.removeLabel+"' class='right deleteIcon' onclick=\"admin.comment.del('"+i[o].oId+"', '"+t+"', '"+e+"')\"></span><span class='right'><a href='mailto:"+i[o].commentEmail+"'>"+i[o].commentEmail+"</a>&nbsp;&nbsp;"+$.bowknot.getDate(i[o].commentTime)+"&nbsp;</span><div class='clear'></div></div><div class='margin12'>"+f+"</div>"}""===s&&(s=Label.noCommentLabel),$("#"+t+"Comments").html(s),$("#loadMsg").text("")}})},del:function(e,t,n){var r=confirm(Label.confirmRemoveLabel);if(r){$("#loadMsg").text(Label.loadingLabel);var i="article";t==="page"&&(i="page"),$.ajax({url:latkeConfig.servePath+"/console/"+i+"/comment/"+e,type:"DELETE",cache:!1,success:function(e,r){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.comment.getList(n,t),$("#loadMsg").text("")}})}}},admin.articleList={tablePagination:new TablePaginate("article"),init:function(e){this.tablePagination.buildTable([{text:Label.titleLabel,index:"title",minWidth:110,style:"padding-left: 12px;font-size:14px;"},{text:Label.authorLabel,index:"author",width:150,style:"padding-left: 12px;"},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"},{text:Label.viewLabel,width:60,index:"articleViewCount",style:"padding-left: 12px;"},{text:Label.createDateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(e)},getList:function(e){var t=this;$("#loadMsg").text(Label.loadingLabel),$.ajax({url:latkeConfig.servePath+"/console/articles/status/published/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=n.articles,s=[];for(var o=0;o<i.length;o++){s[o]={},s[o].title="<a href='"+latkeConfig.servePath+i[o].articlePermalink+"' target='_blank' title='"+i[o].articleTitle+"' class='no-underline'>"+i[o].articleTitle+"</a><span class='table-tag'>"+i[o].articleTags+"</span>",s[o].date=$.bowknot.getDate(i[o].articleCreateTime),s[o].comments=i[o].articleCommentCount,s[o].articleViewCount=i[o].articleViewCount,s[o].author=i[o].authorName;var u=i[o].articlePutTop?Label.cancelPutTopLabel:Label.putTopLabel;s[o].expendRow="<a target='_blank' href='"+latkeConfig.servePath+i[o].articlePermalink+"'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.get('"+i[o].oId+"', true)\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+i[o].oId+"', 'article')\">"+Label.removeLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.articleList.popTop(this, '"+i[o].oId+"')\">"+u+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.comment.open('"+i[o].oId+"', 'article')\">"+Label.commentLabel+"</a>"}t.tablePagination.updateTablePagination(s,e,n.pagination),$("#loadMsg").text("")}})},popTop:function(e,t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var n=$(e),r="canceltop",i=Label.putTopLabel;n.html()===Label.putTopLabel&&(r="puttop",i=Label.cancelPutTopLabel),$.ajax({url:latkeConfig.servePath+"/console/article/"+r+"/"+t,type:"PUT",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}n.html(i)}})}},admin.register["article-list"]={obj:admin.articleList,init:admin.articleList.init,refresh:admin.articleList.getList},admin.draftList={tablePagination:new TablePaginate("draft"),init:function(e){this.tablePagination.buildTable([{text:Label.titleLabel,index:"title",minWidth:110,style:"padding-left: 12px;font-size:14px;"},{text:Label.authorLabel,index:"author",width:150,style:"padding-left: 12px;"},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"},{text:Label.viewLabel,width:60,index:"articleViewCount",style:"padding-left: 12px;"},{text:Label.createDateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(e)},getList:function(e){$("#loadMsg").text(Label.loadingLabel);var t=this;$.ajax({url:latkeConfig.servePath+"/console/articles/status/unpublished/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=n.articles,s=[];for(var o=0;o<i.length;o++)s[o]={},s[o].tags=i[o].articleTags,s[o].date=$.bowknot.getDate(i[o].articleCreateTime),s[o].comments=i[o].articleCommentCount,s[o].articleViewCount=i[o].articleViewCount,s[o].author=i[o].authorName,s[o].title="<a class='no-underline' href='"+latkeConfig.servePath+i[o].articlePermalink+"' target='_blank'>"+i[o].articleTitle+"</a><span class='table-tag'>"+i[o].articleTags+"</span>",s[o].expendRow="<a target='_blank' href='"+latkeConfig.servePath+i[o].articlePermalink+"'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.get('"+i[o].oId+"', false);\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+i[o].oId+"', 'draft')\">"+Label.removeLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.comment.open('"+i[o].oId+"', 'draft')\">"+Label.commentLabel+"</a>";t.tablePagination.updateTablePagination(s,e,n.pagination),$("#loadMsg").text("")}})}},admin.register["draft-list"]={obj:admin.draftList,init:admin.draftList.init,refresh:admin.draftList.getList},admin.pageList={tablePagination:new TablePaginate("page"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},id:"",type:"link",init:function(e){this.tablePagination.buildTable([{text:"",index:"pageOrder",width:60,style:"padding-left: 12px;font-size:14px;"},{style:"padding-left: 12px;",text:Label.titleLabel,index:"pageTitle",width:300},{style:"padding-left: 12px;",text:Label.permalinkLabel,index:"pagePermalink",minWidth:300},{style:"padding-left: 12px;",text:Label.openMethodLabel,index:"pageTarget",width:120},{style:"padding-left: 12px;",text:Label.typeLabel,index:"pageType",width:80},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(e);var t=Label.localeString.substring(0,2);t==="zh"&&(t="zh-cn"),admin.editorPage=new Editor({language:t,kind:"all",id:"pageContent"}),$(".fn-type").click(function(){var e=$(this);if(e.hasClass("selected"))return;$(".fn-type").removeClass("selected"),e.addClass("selected"),admin.pageList.type=e.data("type"),admin.pageList.type==="page"?($("#pagePagePanel").slideDown(),Label.editorType==="CodeMirror-Markdown"&&admin.editorPage.getContent()===""&&admin.editorPage.setContent("")):$("#pagePagePanel").slideUp()})},getList:function(e){$("#loadMsg").text(Label.loadingLabel);var t=this;$.ajax({url:latkeConfig.servePath+"/console/pages/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=n.pages,s=[];admin.pageList.pageInfo.currentCount=i.length,admin.pageList.pageInfo.pageCount=n.pagination.paginationPageCount===0?1:n.pagination.paginationPageCount;for(var o=0;o<i.length;o++)s[o]={},o===0?i.length===1?s[o].pageOrder="":s[o].pageOrder='<div class="table-center" style="width:14px">                                        <span onclick="admin.pageList.changeOrder('+i[o].oId+", "+o+', \'down\');"                                         class="table-downIcon"></span></div>':o===i.length-1?s[o].pageOrder='<div class="table-center" style="width:14px">                                    <span onclick="admin.pageList.changeOrder('+i[o].oId+", "+o+', \'up\');" class="table-upIcon"></span>                                    </div>':s[o].pageOrder='<div class="table-center" style="width:38px">                                    <span onclick="admin.pageList.changeOrder('+i[o].oId+", "+o+', \'up\');" class="table-upIcon"></span>                                    <span onclick="admin.pageList.changeOrder('+i[o].oId+", "+o+', \'down\');" class="table-downIcon"></span>                                    </div>',s[o].pageTitle="<a class='no-underline' href='"+i[o].pagePermalink+"' target='_blank'>"+i[o].pageTitle+"</a>",s[o].pagePermalink="<a class='no-underline' href='"+i[o].pagePermalink+"' target='_blank'>"+i[o].pagePermalink+"</a>",s[o].pageTarget=i[o].pageOpenTarget,s[o].pageType=i[o].pageType,s[o].comments=i[o].pageCommentCount,s[o].expendRow="<span><a href='"+i[o].pagePermalink+"' target='_blank'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.pageList.get('"+i[o].oId+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.pageList.del('"+i[o].oId+"')\">"+Label.removeLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.comment.open('"+i[o].oId+"', 'page')\">"+Label.commentLabel+"</a></span>";t.tablePagination.updateTablePagination(s,e,n.pagination),$("#loadMsg").text("")}})},get:function(e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:latkeConfig.servePath+"/console/page/"+e,type:"GET",cache:!1,success:function(t,n){$("#tipMsg").text(t.msg);if(!t.sc){$("#loadMsg").text("");return}admin.pageList.id=e,$("#pageTitle").val(t.page.pageTitle),$("#pagePermalink").val(t.page.pagePermalink),$("#pageTarget").val(t.page.pageOpenTarget),t.page.pageType==="page"?$($(".fn-type").get(1)).click():$($(".fn-type").get(0)).click(),$("#pageCommentable").prop("checked",t.page.pageCommentable),admin.editorPage.setContent(t.page.pageContent),$("#loadMsg").text("")}})},del:function(e){var t=confirm(Label.confirmRemoveLabel);t&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:latkeConfig.servePath+"/console/page/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}var n=admin.pageList.pageInfo.currentPage;admin.pageList.pageInfo.currentCount===1&&admin.pageList.pageInfo.pageCount!==1&&admin.pageList.pageInfo.currentPage===admin.pageList.pageInfo.pageCount&&(admin.pageList.pageInfo.pageCount--,n=admin.pageList.pageInfo.pageCount);var r=window.location.hash.split("/");n==r[r.length-1]?admin.pageList.getList(n):admin.setHashByPage(n),$("#loadMsg").text("")}}))},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=admin.editorPage.getContent(),t=$("#pagePermalink").val().replace(/(^\s*)|(\s*$)/g,"");admin.pageList.type==="link"&&(t=Util.proessURL(t));var n={page:{pageTitle:$("#pageTitle").val(),pageContent:e,pagePermalink:t,pageCommentable:$("#pageCommentable").prop("checked"),pageType:admin.pageList.type,pageOpenTarget:$("#pageTarget").val()}};$.ajax({url:latkeConfig.servePath+"/console/page/",type:"POST",cache:!1,data:JSON.stringify(n),success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.pageList.id="",$("#pagePermalink").val(""),$("#pageTitle").val(""),$("#pageCommentable").prop("cheked",!1),$("#pageTarget").val("_self"),$($(".fn-type").get(0)).click(),admin.editorPage.setContent(""),admin.pageList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.pageList.pageInfo.currentPage===admin.pageList.pageInfo.pageCount&&admin.pageList.pageInfo.pageCount++;var n=window.location.hash.split("/");admin.pageList.pageInfo.pageCount==n[n.length-1]?admin.pageList.getList(admin.pageList.pageInfo.pageCount):admin.setHashByPage(admin.pageList.pageInfo.pageCount),$("#loadMsg").text("")}})}},update:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=admin.editorPage.getContent(),t=$("#pagePermalink").val().replace(/(^\s*)|(\s*$)/g,"");admin.pageList.type==="link"&&(t=Util.proessURL(t));var n={page:{pageTitle:$("#pageTitle").val(),oId:this.id,pageContent:e,pagePermalink:t,pageCommentable:$("#pageCommentable").prop("checked"),pageType:admin.pageList.type,pageOpenTarget:$("#pageTarget").val()}};$.ajax({url:latkeConfig.servePath+"/console/page/",type:"PUT",cache:!1,data:JSON.stringify(n),success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.pageList.id="",admin.pageList.getList(admin.pageList.pageInfo.currentPage),$("#pageTitle").val(""),$("#pagePermalink").val(""),$("#pageCommentable").prop("cheked",!1),$("#pageTarget").val("_self"),$($(".fn-type").get(0)).click(),admin.editorPage.setContent(""),$("#loadMsg").text("")}})}},validate:function(){if($("#pageTitle").val().replace(/\s/g,"")==="")$("#tipMsg").text(Label.titleEmptyLabel),$("#pageTitle").focus();else{if(admin.pageList.type!=="link"||$("#pagePermalink").val().replace(/\s/g,"")!=="")return!0;$("#tipMsg").text(Label.linkEmptyLabel)}return!1},submit:function(){this.id!==""?this.update():this.add()},changeOrder:function(e,t,n){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var r={oId:e.toString(),direction:n};$.ajax({url:latkeConfig.servePath+"/console/page/order/",type:"PUT",cache:!1,data:JSON.stringify(r),success:function(e,t){$("#tipMsg").text(e.msg),admin.pageList.getList(admin.pageList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["page-list"]={obj:admin.pageList,init:admin.pageList.init,refresh:admin.pageList.getList},admin.others={init:function(
){$("#tabOthers").tabs(),$.ajax({url:latkeConfig.servePath+"/console/reply/notification/template",type:"GET",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}$("#replayEmailTemplateTitle").val(e.replyNotificationTemplate.subject),$("#replayEmailTemplateBody").val(e.replyNotificationTemplate.body),$("#loadMsg").text("")}})},removeUnusedTags:function(){$("#tipMsg").text(""),$.ajax({url:latkeConfig.servePath+"/console/tag/unused",type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg)}})},getUnusedTags:function(){$.ajax({url:latkeConfig.servePath+"/console/tag/unused",type:"GET",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}var n=e.unusedTags;if(0===n.length)return}})},update:function(){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={replyNotificationTemplate:{subject:$("#replayEmailTemplateTitle").val(),body:$("#replayEmailTemplateBody").val()}};$.ajax({url:latkeConfig.servePath+"/console/reply/notification/template",type:"PUT",cache:!1,data:JSON.stringify(e),success:function(e,t){$("#tipMsg").text(e.msg),$("#loadMsg").text("")}})}},admin.register.others={obj:admin.others,init:admin.others.init,refresh:function(){$("#loadMsg").text("")}},admin.linkList={tablePagination:new TablePaginate("link"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},id:"",init:function(e){this.tablePagination.buildTable([{text:"",index:"linkOrder",width:60},{style:"padding-left: 12px;",text:Label.linkTitleLabel,index:"linkTitle",width:230},{style:"padding-left: 12px;",text:Label.urlLabel,index:"linkAddress",minWidth:180},{style:"padding-left: 12px;",text:Label.linkDescriptionLabel,index:"linkDescription",width:360}]),this.tablePagination.initPagination(),this.getList(e),$("#updateLink").dialog({width:700,height:180,modal:!0,hideFooter:!0})},getList:function(e){$("#loadMsg").text(Label.loadingLabel),e===0&&(e=1),this.pageInfo.currentPage=e;var t=this;$.ajax({url:latkeConfig.servePath+"/console/links/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=n.links,s=[];admin.linkList.pageInfo.currentCount=i.length,admin.linkList.pageInfo.pageCount=n.pagination.paginationPageCount===0?1:n.pagination.paginationPageCount;for(var o=0;o<i.length;o++)s[o]={},o===0?i.length===1?s[o].linkOrder="":s[o].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.linkList.changeOrder('+i[o].oId+", "+o+', \'down\');" class="table-downIcon"></span>                            </div>':o===i.length-1?s[o].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.linkList.changeOrder('+i[o].oId+", "+o+', \'up\');" class="table-upIcon"></span>                            </div>':s[o].linkOrder='<div class="table-center" style="width:38px">                                <span onclick="admin.linkList.changeOrder('+i[o].oId+", "+o+', \'up\');" class="table-upIcon"></span>                                <span onclick="admin.linkList.changeOrder('+i[o].oId+", "+o+', \'down\');" class="table-downIcon"></span>                            </div>',s[o].linkTitle=i[o].linkTitle,s[o].linkAddress="<a target='_blank' class='no-underline' href='"+i[o].linkAddress+"'>"+i[o].linkAddress+"</a>",s[o].linkDescription=i[o].linkDescription,s[o].expendRow="<span><a href='"+i[o].linkAddress+"' target='_blank'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.linkList.get('"+i[o].oId+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.linkList.del('"+i[o].oId+"')\">"+Label.removeLabel+"</a></span>";t.tablePagination.updateTablePagination(s,e,n.pagination),$("#loadMsg").text("")}})},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={link:{linkTitle:$("#linkTitle").val(),linkAddress:$("#linkAddress").val(),linkDescription:$("#linkDescription").val()}};$.ajax({url:latkeConfig.servePath+"/console/link/",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}$("#linkTitle").val(""),$("#linkAddress").val(""),$("#linkDescription").val(""),admin.linkList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.linkList.pageInfo.currentPage===admin.linkList.pageInfo.pageCount&&admin.linkList.pageInfo.pageCount++;var n=window.location.hash.split("/");admin.linkList.pageInfo.pageCount!==parseInt(n[n.length-1])&&admin.setHashByPage(admin.linkList.pageInfo.pageCount),admin.linkList.getList(admin.linkList.pageInfo.pageCount),$("#loadMsg").text("")}})}},get:function(e){$("#loadMsg").text(Label.loadingLabel),$("#updateLink").dialog("open"),$.ajax({url:latkeConfig.servePath+"/console/link/"+e,type:"GET",cache:!1,success:function(t,n){$("#tipMsg").text(t.msg);if(!t.sc){$("#loadMsg").text("");return}admin.linkList.id=e,$("#linkTitleUpdate").val(t.link.linkTitle),$("#linkAddressUpdate").val(t.link.linkAddress),$("#linkDescriptionUpdate").val(t.link.linkDescription),$("#loadMsg").text("")}})},update:function(){if(this.validate("Update")){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={link:{linkTitle:$("#linkTitleUpdate").val(),oId:this.id,linkAddress:$("#linkAddressUpdate").val(),linkDescription:$("#linkDescriptionUpdate").val()}};$.ajax({url:latkeConfig.servePath+"/console/link/",type:"PUT",cache:!1,data:JSON.stringify(e),success:function(e,t){$("#updateLink").dialog("close"),$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.linkList.getList(admin.linkList.pageInfo.currentPage),$("#loadMsg").text("")}})}},del:function(e){var t=confirm(Label.confirmRemoveLabel);t&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:latkeConfig.servePath+"/console/link/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}var n=admin.linkList.pageInfo.currentPage;admin.linkList.pageInfo.currentCount===1&&admin.linkList.pageInfo.pageCount!==1&&admin.linkList.pageInfo.currentPage===admin.linkList.pageInfo.pageCount&&(admin.linkList.pageInfo.pageCount--,n=admin.linkList.pageInfo.pageCount);var r=window.location.hash.split("/");n!==parseInt(r[r.length-1])&&admin.setHashByPage(n),admin.linkList.getList(n),$("#loadMsg").text("")}}))},validate:function(e){e||(e="");if($("#linkTitle"+e).val().replace(/\s/g,"")==="")$("#tipMsg").text(Label.titleEmptyLabel),$("#linkTitle"+e).focus().val("");else if($("#linkAddress"+e).val().replace(/\s/g,"")==="")$("#tipMsg").text(Label.addressEmptyLabel),$("#linkAddress"+e).focus().val("");else{if(!!/^\w+:\/\//.test($("#linkAddress"+e).val()))return!0;$("#tipMsg").text(Label.addressInvalidLabel),$("#linkAddress"+e).focus().val("")}return!1},changeOrder:function(e,t,n){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var r={oId:e.toString(),direction:n};$.ajax({url:latkeConfig.servePath+"/console/link/order/",type:"PUT",cache:!1,data:JSON.stringify(r),success:function(e,t){$("#tipMsg").text(e.msg),admin.linkList.getList(admin.linkList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["link-list"]={obj:admin.linkList,init:admin.linkList.init,refresh:admin.linkList.getList},admin.preference={locale:"",editorType:"",init:function(){$("#tabPreference").tabs(),$.ajax({url:latkeConfig.servePath+"/console/preference/",type:"GET",cache:!1,success:function(result,textStatus){$("#tipMsg").text(result.msg);if(!result.sc){$("#loadMsg").text("");return}var preference=result.preference;preference.blogHost.indexOf("localhost")>-1&&Label.miniPostfix===".min"&&(preference.blogHost=window.location.host,$("#tipMsg").text(Label.resetBlogHostLabel)),$("#metaKeywords").val(preference.metaKeywords),$("#metaDescription").val(preference.metaDescription),$("#blogTitle").val(preference.blogTitle),$("#blogSubtitle").val(preference.blogSubtitle),$("#mostCommentArticleDisplayCount").val(preference.mostCommentArticleDisplayCount),$("#mostViewArticleDisplayCount").val(preference.mostViewArticleDisplayCount),$("#recentCommentDisplayCount").val(preference.recentCommentDisplayCount),$("#mostUsedTagDisplayCount").val(preference.mostUsedTagDisplayCount),$("#articleListDisplayCount").val(preference.articleListDisplayCount),$("#articleListPaginationWindowSize").val(preference.articleListPaginationWindowSize),$("#blogHost").val(preference.blogHost),$("#localeString").val(preference.localeString),$("#timeZoneId").val(preference.timeZoneId),$("#noticeBoard").val(preference.noticeBoard),$("#htmlHead").val(preference.htmlHead),$("#externalRelevantArticlesDisplayCount").val(preference.externalRelevantArticlesDisplayCount),$("#relevantArticlesDisplayCount").val(preference.relevantArticlesDisplayCount),$("#randomArticlesDisplayCount").val(preference.randomArticlesDisplayCount),$("#keyOfSolo").val(preference.keyOfSolo),preference.enableArticleUpdateHint?$("#enableArticleUpdateHint").attr("checked","checked"):$("#enableArticleUpdateHint").removeAttr("checked"),preference.allowVisitDraftViaPermalink?$("#allowVisitDraftViaPermalink").attr("checked","checked"):$("allowVisitDraftViaPermalink").removeAttr("checked"),admin.preference.locale=preference.localeString,admin.preference.editorType=preference.editorType,$("#skinMain").data("skinDirName",preference.skinDirName);var skins=eval("("+preference.skins+")"),skinsHTML="";for(var i=0;i<skins.length;i++){var selectedClass="";skins[i].skinName===preference.skinName&&skins[i].skinDirName===preference.skinDirName&&(selectedClass+=" selected"),skinsHTML+="<div title='"+skins[i].skinDirName+"' class='left skinItem"+selectedClass+"'><img class='skinPreview' src='"+latkeConfig.staticServePath+"/skins/"+skins[i].skinDirName+"/preview.png'/><div>"+skins[i].skinName+"</div></div>"}$("#skinMain").append(skinsHTML+"<div class='clear'></div>"),$(".skinItem").click(function(){$(".skinItem").removeClass("selected"),$(this).addClass("selected"),$("#skinMain").data("skinDirName",this.title)});var signs=eval("("+preference.signs+")");for(var j=1;j<signs.length;j++)$("#preferenceSign"+j).val(signs[j].signHTML),$("#preferenceSignButton"+j).tip({content:signs[j].signHTML===""?Label.signIsNullLabel:signs[j].signHTML.replace(/\n/g,"").replace(/<script.*<\/script>/ig,""),position:"bottom"});$("#articleListDisplay").val(preference.articleListStyle),$("#editorType").val(preference.editorType),$("#feedOutputMode").val(preference.feedOutputMode),preference.commentable?$("#commentable").attr("checked","checked"):$("commentable").removeAttr("checked"),$("#loadMsg").text("")}})},validate:function(){return/^\d+$/.test($("#mostUsedTagDisplayCount").val())?/^\d+$/.test($("#recentCommentDisplayCount").val())?/^\d+$/.test($("#mostCommentArticleDisplayCount").val())?/^\d+$/.test($("#mostViewArticleDisplayCount").val())?/^\d+$/.test($("#articleListDisplayCount").val())?/^\d+$/.test($("#articleListPaginationWindowSize").val())?/^\d+$/.test($("#randomArticlesDisplayCount").val())?/^\d+$/.test($("#relevantArticlesDisplayCount").val())?/^\d+$/.test($("#externalRelevantArticlesDisplayCount").val())?!0:($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.externalRelevantArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#externalRelevantArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.relevantArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#relevantArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.randomArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#randomArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.windowSizeLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#articleListPaginationWindowSize").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.pageSizeLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#articleListDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexMostViewArticleDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostViewArticleDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexMostCommentArticleDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostCommentArticleDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexRecentCommentDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#recentCommentDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexTagDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostUsedTagDisplayCount").focus(),!1)},update:function(){if(!admin.preference.validate())return;$("#tipMsg").text(""),$("#loadMsg").text(Label.loadingLabel);var e=[{oId:0,signHTML:""},{oId:1,signHTML:$("#preferenceSign1").val()},{oId:2,signHTML:$("#preferenceSign2").val()},{oId:3,signHTML:$("#preferenceSign3").val()}],t={preference:{metaKeywords:$("#metaKeywords").val(),metaDescription:$("#metaDescription").val(),blogTitle:$("#blogTitle").val(),blogSubtitle:$("#blogSubtitle").val(),mostCommentArticleDisplayCount:$("#mostCommentArticleDisplayCount").val(),mostViewArticleDisplayCount:$("#mostViewArticleDisplayCount").val(),recentCommentDisplayCount:$("#recentCommentDisplayCount").val(),mostUsedTagDisplayCount:$("#mostUsedTagDisplayCount").val(),articleListDisplayCount:$("#articleListDisplayCount").val(),articleListPaginationWindowSize:$("#articleListPaginationWindowSize").val(),skinDirName:$("#skinMain").data("skinDirName"),blogHost:$("#blogHost").val(),localeString:$("#localeString").val(),timeZoneId:$("#timeZoneId").val(),noticeBoard:$("#noticeBoard").val(),htmlHead:$("#htmlHead").val(),externalRelevantArticlesDisplayCount:$("#externalRelevantArticlesDisplayCount").val(),relevantArticlesDisplayCount:$("#relevantArticlesDisplayCount").val(),randomArticlesDisplayCount:$("#randomArticlesDisplayCount").val(),enableArticleUpdateHint:$("#enableArticleUpdateHint").prop("checked"),signs:e,keyOfSolo:$("#keyOfSolo").val(),allowVisitDraftViaPermalink:$("#allowVisitDraftViaPermalink").prop("checked"),articleListStyle:$("#articleListDisplay").val(),editorType:$("#editorType").val(),feedOutputMode:$("#feedOutputMode").val(),commentable:$("#commentable").prop("checked")}};$.ajax({url:latkeConfig.servePath+"/console/preference/",type:"PUT",cache:!1,data:JSON.stringify(t),success:function(t,n){$("#tipMsg").text(t.msg);if(!t.sc){$("#loadMsg").text("");return}($("#localeString").val()!==admin.preference.locale||$("#editorType").val()!==admin.preference.editorType)&&window.location.reload();for(var r=1;r<e.length;r++)$("#articleSign"+e[r].oId).length===1&&$("#articleSign"+e[r].oId).tip("option","content",e[r].signHTML===""?Label.signIsNullLabel:e[r].signHTML.replace(/\n/g,"").replace(/<script.*<\/script>/ig,"")),$("#preferenceSignButton"+e[r].oId).tip("option","content",e[r].signHTML===""?Label.signIsNullLabel:e[r].signHTML.replace(/\n/g,"").replace(/<script.*<\/script>/ig,""));$("#loadMsg").text("")}})}},admin.register.preference={obj:admin.preference,init:admin.preference.init,refresh:function(){$("#loadMsg").text("")}},admin.pluginList={tablePagination:new TablePaginate("plugin"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},init:function(e){this.tablePagination.buildTable([{style:"padding-left: 12px;",text:Label.pluginNameLabel,index:"name",width:230},{style:"padding-left: 12px;",text:Label.statusLabel,index:"status",minWidth:180},{style:"padding-left: 12px;",text:Label.authorLabel,index:"author",width:200},{style:"padding-left: 12px;",text:Label.versionLabel,index:"version",width:120}]),this.tablePagination.initPagination(),this.getList(e)},getList:function(e){$("#loadMsg").text(Label.loadingLabel);var t=this;$.ajax({url:latkeConfig.servePath+"/console/plugins/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}admin.pluginList.pageInfo.currentPage=e;var i=n.plugins;for(var s=0;s<i.length;s++)i[s].expendRow="<a href='javascript:void(0)' onclick=\"admin.pluginList.changeStatus('"+i[s].oId+"', '"+i[s].status+"')\">",i[s].status==="ENABLED"?(i[s].status=Label.enabledLabel,i[s].expendRow+=Label.disableLabel):(i[s].status=Label.disabledLabel,i[s].expendRow+=Label.enableLabel),i[s].expendRow+="</a>";t.tablePagination.updateTablePagination(n.plugins,e,n.pagination),$("#loadMsg").text("")}})},changeStatus:function(e,t){t==="ENABLED"?t="DISABLED":t="ENABLED";var n={oId:e,status:t};$.ajax({url:latkeConfig.servePath+"/console/plugin/status/",type:"PUT",cache:!1,data:JSON.stringify(n),success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}$("#loadMsg").text(""),window.location.reload()}})}},admin.register["plugin-list"]={obj:admin.pluginList,init:admin.pluginList.init,refresh:function(){$("#loadMsg").text("")}},admin.userList={tablePagination:new TablePaginate("user"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},userInfo:{oId:"",userRole:""},init:function(e){this.tablePagination.buildTable([{style:"padding-left: 12px;",text:Label.commentNameLabel,index:"userName",width:230},{style:"padding-left: 12px;",text:Label.commentEmailLabel,index:"userEmail",minWidth:180},{style:"padding-left: 12px;",text:Label.administratorLabel,index:"isAdmin",width:120}]),this.tablePagination.initPagination(),this.getList(e),$("#userUpdate").dialog({width:700,height:190,modal:!0,hideFooter:!0})},getList:function(e){$("#loadMsg").text(Label.loadingLabel),this.pageInfo.currentPage=e;var t=this;$.ajax({url:latkeConfig.servePath+"/console/users/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=n.users,s=[];admin.userList.pageInfo.currentCount=i.length,admin.userList.pageInfo.pageCount=n.pagination.paginationPageCount;if(i.length<1){$("#tipMsg").text("No user  "+Label.reportIssueLabel),$("#loadMsg").text("");return}for(var o=0;o<i.length;o++)s[o]={},s[o].userName=i[o].userName,s[o].userEmail=i[o].userEmail,"adminRole"===i[o].userRole?(s[o].isAdmin="&nbsp;"+Label.administratorLabel,s[o].expendRow="<a href='javascript:void(0)' onclick=\"admin.userList.get('"+i[o].oId+"', '"+i[o].userRole+"')\">"+Label.updateLabel+"</a>"):(s[o].expendRow="<a href='javascript:void(0)' onclick=\"admin.userList.get('"+i[o].oId+"', '"+i[o].userRole+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.userList.del('"+i[o].oId+"')\">"+Label.removeLabel+"</a>",s[o].isAdmin=Label.commonUserLabel);t.tablePagination.updateTablePagination(s,e,n.pagination),$("#loadMsg").text("")}})},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={userName:$("#userName").val(),userEmail:$("#userEmail").val(),userPassword:$("#userPassword").val()};$.ajax({url:latkeConfig.servePath+"/console/user/",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}$("#userName").val(""),$("#userEmail").val(""),$("#userPassword").val(""),admin.userList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.userList.pageInfo.currentPage===admin.userList.pageInfo.pageCount&&admin.userList.pageInfo.pageCount++;var n=window.location.hash.split("/");admin.userList.pageInfo.pageCount!==parseInt(n[n.length-1])&&admin.setHashByPage(admin.userList.pageInfo.pageCount),admin.userList.getList(admin.userList.pageInfo.pageCount),$("#loadMsg").text("")}})}},get:function(e,t){$("#loadMsg").text(Label.loadingLabel),$("#userUpdate").dialog("open"),$.ajax({url:latkeConfig.servePath+"/console/user/"+e,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}var i=$("#userEmailUpdate");$("#userNameUpdate").val(n.user.userName).data("userInfo",{oId:e,userRole:t}),i.val(n.user.userEmail),"adminRole"===t?i.attr("disabled","disabled"):i.removeAttr("disabled"),$("#userPasswordUpdate").val(n.user.userPassword),$("#loadMsg").text("")}})},update:function(){if(this.validate("Update")){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#userNameUpdate").data("userInfo"),t={userName:$("#userNameUpdate").val(),oId:e.oId,userEmail:$("#userEmailUpdate").val(),userRole:e.userRole,userPassword:$("#userPasswordUpdate").val()};$.ajax({url:latkeConfig.servePath+"/console/user/",type:"PUT",cache:!1,data:JSON.stringify(t),success:function(e,t){$("#userUpdate").dialog("close"),$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.userList.getList(admin.userList.pageInfo.currentPage),$("#loadMsg").text("")}})}},del:function(e){var t=confirm(Label.confirmRemoveLabel);t&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:latkeConfig.servePath+"/console/user/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}var n=admin.userList.pageInfo.currentPage;admin.userList.pageInfo.currentCount===1&&admin.userList.pageInfo.pageCount!==1&&admin.userList.pageInfo.currentPage===admin.userList.pageInfo.pageCount&&(admin.userList.pageInfo.pageCount--,n=admin.userList.pageInfo.pageCount);var r=window.location.hash.split("/");n!==parseInt(r[r.length-1])&&admin.setHashByPage(n),admin.userList.getList(n),$("#loadMsg").text("")}}))},validate:function(e){e||(e="");if($("#userName"+e).val().replace(/\s/g,"")==="")$("#tipMsg").text(Label.nameEmptyLabel),$("#userName"+e).focus();else if($("#userEmail"+e).val().replace(/\s/g,"")==="")$("#tipMsg").text(Label.mailCannotEmptyLabel),$("#userEmail"+e).focus();else if(!/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test($("#userEmail"+e).val()))$("#tipMsg").text(Label.mailInvalidLabel),$("#userEmail"+e).focus();else{if($("#userPassword"+e).val().replace(/\s/g,"")!=="")return!0;$("#tipMsg").text(Label.passwordEmptyLabel),$("#userPassword"+e).focus()}return!1}},admin.register["user-list"]={obj:admin.userList,init:admin.userList.init,refresh:function(){$("#loadMsg").text("")}},admin.commentList={tablePagination:new TablePaginate("comment"),pageInfo:{currentPage:1},init:function(e){this.tablePagination.buildTable([{text:Label.commentContentLabel,index:"content",minWidth:300,style:"padding-left: 12px;"},{text:Label.authorLabel,index:"title",width:230,style:"padding-left: 12px;"},{text:Label.createDateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.getList(e)},getList:function(e){var t=this;$("#loadMsg").text(Label.loadingLabel),$.ajax({url:latkeConfig.servePath+"/console/comments/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(n,r){$("#tipMsg").text(n.msg);if(!n.sc){$("#loadMsg").text("");return}t.pageInfo.currentPage=e;var i=n.comments,s=[];for(var o=0;o<i.length;o++){var u="Article";i[o].type==="pageComment"&&(u="Page"),s[o]={},s[o].content=Util.replaceEmString(i[o].commentContent)+"<span class='table-tag'> on &nbsp;&nbsp;</span><a href='"+latkeConfig.servePath+i[o].commentSharpURL+"' target='_blank'>"+i[o].commentTitle+"</a>",s[o].expendRow="<a href='javascript:void(0)' onclick=\"admin.commentList.del('"+i[o].oId+"', '"+u+"')\">"+Label.removeLabel+"</a>",s[o].title="<img class='small-head' src='"+i[o].commentThumbnailURL+"'/>","http://"===i[o].commentURL?s[o].title+=i[o].commentName:s[o].title+="<a href='"+i[o].commentURL+"' target='_blank' class='no-underline'>"+i[o].commentName+"</a>",s[o].title+="<br/><a href='mailto:"+i[o].commentEmail+"'>"+i[o].commentEmail+"</a>",s[o].date=$.bowknot.getDate(i[o].commentTime)}t.tablePagination.updateTablePagination(s,e,n.pagination),$("#loadMsg").text("")}})},del:function(e,t){confirm(Label.confirmRemoveLabel)&&($("#loadMsg").text(Label.loadingLabel),$.ajax({url:latkeConfig.servePath+"/console/"+t.toLowerCase()+"/comment/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg);if(!e.sc){$("#loadMsg").text("");return}admin.commentList.getList(admin.commentList.pageInfo.currentPage),$("#loadMsg").text("")}}))}},admin.register["comment-list"]={obj:admin.commentList,init:admin.commentList.init,refresh:admin.commentList.getList};var plugins={};admin.plugin={plugins:[],add:function(e){e.isInit=!1,e.hash=e.path.replace("/","#")+"/"+e.id,this.plugins.push(e);var t=this._analysePath(e.path);e.index&&t.length<2&&this._addNew(e,t)},setCurByHash:function(e){var t=this.plugins;for(var n=0;n<t.length;n++){var r=t[n],i=this._analysePath(r.path),s=!1;if(r.index&&window.location.hash.indexOf(r.hash)>-1)s=!0;else if(r.path.replace("/","#")===window.location.hash||window.location.hash==="#main"&&r.path.indexOf("/main/panel")>-1)s=!0;s&&(r.isInit?plugins[r.id].refresh&&plugins[r.id].refresh(e.page):(r.index?i.length===2&&this._addNew(r,i):this._addToExist(r,i),plugins[r.id].init(e.page),r.isInit=!0))}},_analysePath:function(e){var t=e.split("/");return t.splice(0,1),t},_addNew:function(e,t){if(t.length===2){e.target=$("#tabPreference li").get(e.index-1),$("#tabPreference").tabs("add",e);return}t[0]===""?e.target=$("#tabs>ul>li").get(e.index-1):t[0]==="article"?e.target=$("#tabArticleMgt>li").get(e.index-1):t[0]==="tools"&&(admin.tools.push("#"+e.id),e.target=$("#tabTools>li").get(e.index-1)),e.target||alert("data.index is error!"),$("#tabs").tabs("add",e)},_addToExist:function(e,t){switch(t[0]){case"main":$("#mainPanel"+t[1].charAt(5)).append(e.content);break;case"tools":case"article":t.length===2?$("#tabsPanel_"+t[1]).append(e.content):$("#tabPreferencePanel_"+t[2]).append(e.content);break;case"comment-list":$("#tabsPanel_comment-list").append(e.content)}}},admin.main={},admin.register.main={obj:admin.main,init:function(){$("#loadMsg").text("")},refresh:function(){$("#loadMsg").text("")}},admin.about={init:function(){$.ajax({url:"http://rhythm.b3log.org/version/solo/latest/"+Label.version,type:"GET",cache:!1,dataType:"jsonp",error:function(){},success:function(e,t){var n=e.soloVersion;n===Label.version?$("#aboutLatest").text(Label.upToDateLabel):$("#aboutLatest").html(Label.outOfDateLabel+"<a href='"+e.soloDownload+"'>"+n+"</a>"),$("#loadMsg").text("")}})}},admin.register.about={obj:admin.about,init:admin.about.init,refresh:function(){$("#loadMsg").text("")}};